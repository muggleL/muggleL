<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>ğŸ“¦âš“ï¸Manjaro Docker ç”¨æ³• - Muggle L</title>
    <meta property="og:title" content="ğŸ“¦âš“ï¸Manjaro Docker ç”¨æ³• - Muggle L">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="ä¸åŒå‘è¡Œç‰ˆçš„æŒ‡ä»¤ï¼Œæ–‡ä»¶ä½ç½®ç•¥æœ‰ä¸åŒï¼Œæœ¬æ–‡ä»…ä»¥ arch åŠå…¶è¡ç”Ÿç³»ç»Ÿä¸ºå‡†ã€‚
[&amp;hellip;] sudo pacman -Syy sudo pacman -S docker # å¯åŠ¨ sudo systemctl start docker # ç”¨æˆ·åŠ å…¥ docker ç”¨æˆ·ç»„ï¼ˆå¯ä»¥ä¸ç”¨ sudo å¯åŠ¨docker) sudo usermod -aG docker $USER # æ³¨é”€é‡æ–°ç™»å½• è®¾ç½® &amp;hellip;">
      <meta property="og:description" content="ä¸åŒå‘è¡Œç‰ˆçš„æŒ‡ä»¤ï¼Œæ–‡ä»¶ä½ç½®ç•¥æœ‰ä¸åŒï¼Œæœ¬æ–‡ä»…ä»¥ arch åŠå…¶è¡ç”Ÿç³»ç»Ÿä¸ºå‡†ã€‚
[&amp;hellip;] sudo pacman -Syy sudo pacman -S docker # å¯åŠ¨ sudo systemctl start docker # ç”¨æˆ·åŠ å…¥ docker ç”¨æˆ·ç»„ï¼ˆå¯ä»¥ä¸ç”¨ sudo å¯åŠ¨docker) sudo usermod -aG docker $USER # æ³¨é”€é‡æ–°ç™»å½• è®¾ç½® &amp;hellip;">
      
    

    
    

    

    
    


<link href='//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/styles/agate.min.css' rel='stylesheet' type='text/css' />




    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="/css/custom.css" />

  </head>

  
  <body class="https://blog.mygoooosh.com/note/2019/08/23/tutorial-of-manjaro-docker/">
    <header class="masthead">
      <h1><a href="/">Muggle L</a></h1>

<p class="tagline">Technology Is Muggle&#39;s Magic</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" />
  <label id="menu-label" for="menu-check" class="unselectable">
    <span class="icon close-icon">âœ•</span>
    <span class="icon open-icon">â˜°</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/">Home</a></li>
  
  <li><a href="/search/">Search</a></li>
  
  <li><a href="/categories/">Categories</a></li>
  
  <li><a href="/tags/">Tags</a></li>
  
  <li><a href="/pdfs/">Pdfs</a></li>
  
  <li><a href="/slice/">Slice</a></li>
  
  <li><a href="https://git.mygoooosh.com/explore/repos">MyGoooosh Git</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      


<h1>ğŸ“¦âš“ï¸Manjaro Docker ç”¨æ³•</h1>

<h3>DG
  /  2019-08-23</h3>
<hr>



      </header>






<p><em><font style="color:red; font-size:13px">ä¸åŒå‘è¡Œç‰ˆçš„æŒ‡ä»¤ï¼Œæ–‡ä»¶ä½ç½®ç•¥æœ‰ä¸åŒï¼Œæœ¬æ–‡ä»…ä»¥ arch åŠå…¶è¡ç”Ÿç³»ç»Ÿä¸ºå‡†ã€‚</font></em></p>
<h4 id="ç›®å½•">ç›®å½•</h4>
<ol>
<li><a href="#%E5%AE%89%E8%A3%85">å®‰è£…</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93">è®¾ç½®é•œåƒä»“åº“</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86">è®¾ç½®ä»£ç†</a></li>
<li><a href="#%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4">åŸºç¡€å‘½ä»¤</a></li>
<li><a href="#dockerfile">Dockerfile</a></li>
<li><a href="#dockerfile-%E5%A4%9A%E6%AE%B5%E6%9E%84%E5%BB%BA">Dockerfile å¤šæ®µæ„å»º</a></li>
<li><a href="#%E5%AE%B9%E5%99%A8%E7%9A%84%E6%93%8D%E4%BD%9C">å®¹å™¨çš„æ“ä½œ</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86">æ•°æ®ç®¡ç†</a></li>
<li><a href="#%E7%BD%91%E7%BB%9C">ç½‘ç»œ</a></li>
</ol>
<h2 id="å®‰è£…">å®‰è£…</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo pacman -Syy
sudo pacman -S docker
<span style="color:#75715e"># å¯åŠ¨</span>
sudo systemctl start docker
<span style="color:#75715e"># ç”¨æˆ·åŠ å…¥ docker ç”¨æˆ·ç»„ï¼ˆå¯ä»¥ä¸ç”¨ sudo å¯åŠ¨docker)</span>
sudo usermod -aG docker $USER
<span style="color:#75715e"># æ³¨é”€é‡æ–°ç™»å½•</span>
</code></pre></div><h2 id="è®¾ç½®é•œåƒä»“åº“">è®¾ç½®é•œåƒä»“åº“</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">echo <span style="color:#e6db74">&#39;{        
</span><span style="color:#e6db74">  &#34;registry-mirrors&#34;: [
</span><span style="color:#e6db74">    &#34;https://dockerhub.azk8s.cn&#34;, # å›½å†…é•œåƒä»“åº“1
</span><span style="color:#e6db74">    &#34;https://reg-mirror.qiniu.com&#34; # ä»“åº“2
</span><span style="color:#e6db74">  ]
</span><span style="color:#e6db74">}&#39;</span> | sudo tee -a /etc/docker/daemon.json &gt; /dev/null
<span style="color:#75715e"># é‡å¯æœåŠ¡</span>
sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre></div><blockquote>
<p>é€šè¿‡ <code>docker info</code> å¯ä»¥çœ‹åˆ°ä»“åº“è®¾ç½®æƒ…å†µã€‚</p>
</blockquote>
<h2 id="è®¾ç½®ä»£ç†">è®¾ç½®ä»£ç†</h2>
<blockquote>
<p>å‚è€ƒ<a href="(https://docs.docker.com/config/daemon/systemd/)">å®˜æ–¹æ–‡æ¡£</a></p>
</blockquote>
<blockquote>
<p>é€šè¿‡ <a href="https://wiki.archlinux.org/index.php/Polipo">polipo</a> å°† <code>socks</code> ä»£ç†è½¬æ¢æˆ <code>http</code> ä»£ç†ã€‚</p>
</blockquote>
<ul>
<li>åˆ›å»º <code>systemd</code> çš„æ’å…¥å¼(<a href="https://wiki.archlinux.org/index.php/systemd#Drop-in_files">drop-in</a>) ç›®å½•</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    sudo mkdir -p /etc/systemd/system/docker.service.d
</code></pre></div><ul>
<li>å»ºç«‹é…ç½®æ–‡ä»¶</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    sudo vim /etc/systemd/system/docker.service.d/http-proxy.conf
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
    <span style="color:#75715e">#NO_PROXY ä¸ºä»£ç†ç™½åå•</span>
    Environment<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;HTTP_PROXY=http://localhost:8123/&#34;</span> <span style="color:#e6db74">&#34;NO_PROXY=localhost,127.0.0.1,docker-registry.example.com,.corp&#34;</span>
</code></pre></div><ul>
<li>åˆ·æ–°</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    sudo systemctl daemon-reload
</code></pre></div><ul>
<li>é‡å¯ <code>Docker</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    sudo systemctl restart docker
</code></pre></div><pre><code>&gt; é€šè¿‡ `docker info` èƒ½çœ‹åˆ°ä»£ç†ä¿¡æ¯ã€‚
</code></pre>
<h2 id="åŸºç¡€å‘½ä»¤">åŸºç¡€å‘½ä»¤</h2>
<ul>
<li>
<h3 id="æŸ¥çœ‹ç‰ˆæœ¬">æŸ¥çœ‹ç‰ˆæœ¬</h3>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker --version
  docker info
</code></pre></div><ul>
<li>
<h3 id="hello-world">Hello-world</h3>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker run hello-world
</code></pre></div><ul>
<li>
<h3 id="list-image">List Image</h3>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker image ls
</code></pre></div><blockquote>
<p><code>docker image ls --help</code> æŸ¥çœ‹æ‰€æœ‰æ“ä½œã€‚</p>
</blockquote>
<ul>
<li>
<h3 id="list-container">List Container</h3>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker container ls       <span style="color:#75715e"># åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨</span>
  docker container ls --all <span style="color:#75715e"># åˆ—å‡ºæ‰€æœ‰</span>
  docker container ls --aq  <span style="color:#75715e"># all in </span>
</code></pre></div><blockquote>
<p><code>docker container ls --help</code> å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„æ“ä½œã€‚</p>
</blockquote>
<ul>
<li>å¯åŠ¨å®¹å™¨</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker run image:tag <span style="color:#75715e"># å¯åŠ¨å®¹å™¨</span>
  docker run -it image:tag <span style="color:#75715e"># è¿›å…¥äº¤äº’å¼ tty ç¯å¢ƒ</span>
  docker run --rm image:tag <span style="color:#75715e"># å®¹å™¨é€€å‡ºåè‡ªåŠ¨åˆ é™¤</span>
  docker run image:tag command <span style="color:#75715e"># å®¹å™¨å¯åŠ¨åæ‰§è¡Œ command å‘½ä»¤</span>
</code></pre></div><blockquote>
<p><code>docker run --help</code> å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„æ“ä½œã€‚</p>
</blockquote>
<h2 id="dockerfile">Dockerfile</h2>
<h3 id="1-from">1. FROM</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">FROM image
</code></pre></div><p><code>FROM</code> æŒ‡å®šåŸºç¡€é•œåƒï¼Œæ˜¯ Dockerfile çš„å¿…å¤‡æŒ‡ä»¤ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚<code>FROM</code> å¯ä»¥æŒ‡å®šåŸºç¡€æœåŠ¡ç±»é•œåƒï¼Œå¦‚ <a href="https://hub.docker.com/_/nginx/">nginx</a> ã€<a href="https://hub.docker.com/_/redis/">redis</a> ç­‰ï¼Œè¯­è¨€é•œåƒ <a href="https://hub.docker.com/_/python/">python</a> ã€<a href="https://hub.docker.com/_/golang/">golang</a> ç­‰ã€‚ä¹Ÿå¯ä»¥æ˜¯æ“ä½œç³»ç»Ÿç±»é•œåƒï¼Œå¦‚ <a href="https://hub.docker.com/_/ubuntu/">ubuntu</a> ã€<a href="https://hub.docker.com/_/alpine/">alpine</a> ç­‰ã€‚</p>
<p>ç‰¹åˆ«çš„ï¼Œ<code>Docker</code> è¿˜å­˜åœ¨ç€ä¸€ä¸ªåä¸º <code>scratch</code> çš„ç‰¹æ®Šé•œåƒï¼Œè¡¨ç¤ºç©ºç™½çš„é•œåƒã€‚</p>
<h3 id="2-run">2. RUN</h3>
<p>RUN æŒ‡å®šæ‰§è¡Œçš„å‘½ä»¤æœ‰ <code>shell æ ¼å¼ </code> å’Œ <code>exec æ ¼å¼</code> ä¸¤ç§å½¢å¼ã€‚</p>
<ul>
<li>shell æ ¼å¼</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  RUN python app.py
</code></pre></div><ul>
<li>exec æ ¼å¼</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  RUN <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;python&#34;</span>, <span style="color:#e6db74">&#34;app.py&#34;</span><span style="color:#f92672">]</span>
</code></pre></div><p><code>Dockerfile</code> ä¸­æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå»ºç«‹ä¸€å±‚ï¼Œ<code>RUN</code> ä¹Ÿä¸ä¾‹å¤–ã€‚å› æ­¤æœ€å¥½åœ¨ä¸€ä¸ª <code>RUN</code> ä¸­æ‰§è¡Œå®Œæ‰€æœ‰çš„å‘½ä»¤ã€‚ä¸ºäº†ä¿è¯é•œåƒçš„ç®€æ´ï¼Œåˆ‡è®°è¦æ¸…é™¤ <code>RUN</code> æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸å¿…è¦çš„ä¸­é—´æ–‡ä»¶å’Œç¼“å­˜æ–‡ä»¶ã€‚</p>
<h3 id="3-copy">3. COPY</h3>
<p>ä¸ <code>RUN</code> ä¸€æ · <code>COPY</code> ä¹Ÿæœ‰ä¸¤ç§æ ¼å¼</p>
<ul>
<li>shell æ ¼å¼</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  COPY <span style="color:#f92672">[</span>--chown<span style="color:#f92672">=</span>&lt;user&gt;:&lt;group&gt;<span style="color:#f92672">]</span> &lt;æºè·¯å¾„&gt;... &lt;ç›®æ ‡è·¯å¾„&gt;
  <span style="color:#75715e"># æ”¯æŒé€šé…ç¬¦ å‚è€ƒ https://golang.org/pkg/path/filepath/#Match</span>
  COPY hom* /app
  COPY hom?.txt /app
  <span style="color:#75715e"># ç”¨æˆ·æƒé™</span>
  COPY --chown<span style="color:#f92672">=</span>theuser:thegroup files* /app
</code></pre></div><ul>
<li>exec æ ¼å¼</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  COPY <span style="color:#f92672">[</span>--chown<span style="color:#f92672">=</span>&lt;user&gt;:&lt;group&gt;<span style="color:#f92672">]</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;&lt;æºè·¯å¾„1&gt;&#34;</span>,... <span style="color:#e6db74">&#34;&lt;ç›®æ ‡è·¯å¾„&gt;&#34;</span><span style="color:#f92672">]</span>
</code></pre></div><p><code>COPY</code> ä¼šä¿ç•™åŸæ–‡ä»¶ï¼Œå¦‚æœæŒ‡å®šç›®å½•ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¯¥ç›®å½•ã€‚<code>COPY</code> ä¹Ÿä¼šä¿ç•™æºæ–‡ä»¶çš„å„ç§å…ƒæ•°æ®ï¼Œæ¯”å¦‚è¯»ã€å†™ã€æ‰§è¡Œã€å˜æ›´æ—¶é—´ç­‰ã€‚</p>
<h3 id="4-add">4. ADD</h3>
<p><code>ADD</code> çš„æ ¼å¼ä¸æ€§è´¨åŸºæœ¬ä¸ <code>COPY</code> ä¸€è‡´ï¼Œä½†åœ¨ å…¶åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›åŠŸèƒ½ã€‚</p>
<ul>
<li>
<p>å¦‚æœ <code>&lt;æºè·¯å¾„&gt;</code> å¯ä»¥æ˜¯ <code>URL</code>ï¼Œ<code>ADD</code> ä¼šè‡ªåŠ¨ä¸‹è½½åˆ°å¯¹åº”ç›®å½•å¹¶ç»™äºˆ <code>600</code> çš„æƒé™ã€‚</p>
</li>
<li>
<p>å¦‚æœ <code>&lt;æºè·¯å¾„&gt;</code> æ˜¯ä¸€ä¸ª <code>tar</code> å‹ç¼©æ–‡ä»¶ï¼Œæ ¼å¼ä¸º <code>gzip</code> ã€<code>bzip2</code> ä»¥åŠ <code>xz</code> çš„è¯ï¼Œ<code>ADD</code> ä¼šè‡ªåŠ¨è§£å‹è¿™ä¸ªæ–‡ä»¶åˆ°ç›®æ ‡æ–‡ä»¶</p>
</li>
</ul>
<p>ç¬¬ä¸€æ¡ <code>URL</code> ä¸­æ›´å¤šçš„æƒ…å†µæ˜¯å‹ç¼©æ–‡ä»¶ å¹¶ä¸”æˆ‘ä»¬æ‰€éœ€è¦çš„æƒé™å¾€å¾€ä¸ä¸€å®šæ˜¯ <code>600</code> ï¼Œæ‰€æœ‰è¿™ç§æƒ…å†µè¿˜æ˜¯ç”¨ <code>RUN</code> æ¯”è¾ƒå®åœ¨ï¼Œå¹¶ä¸æ¨èç”¨ <code>ADD</code></p>
<blockquote>
<p>å½“ä»…ä»…å¤åˆ¶æ–‡ä»¶æ—¶ï¼Œç”¨ <code>COPY</code> ã€‚</p>
<p>å½“å¤åˆ¶ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œå¹¶ä¸”è¦è§£å‹æ—¶ç”¨ <code>ADD</code> ã€‚</p>
</blockquote>
<h3 id="5-cmd">5. CMD</h3>
<p><code>CMD</code> å‘½ä»¤ä¸ <code>RUN</code> ç›¸ä¼¼</p>
<ul>
<li>shell æ ¼å¼</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  CMD &lt;å‘½ä»¤&gt;
</code></pre></div><ul>
<li>exec æ ¼å¼</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;å¯æ‰§è¡Œæ–‡ä»¶&#34;</span>, <span style="color:#e6db74">&#34;å‚æ•°1&#34;</span>, <span style="color:#e6db74">&#34;å‚æ•°2&#34;</span>...<span style="color:#f92672">]</span> <span style="color:#75715e"># åªèƒ½ç”¨ &#34; ä¸èƒ½ç”¨ &#39;</span>
</code></pre></div><ul>
<li>å‚æ•°åˆ—è¡¨æ ¼å¼</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  <span style="color:#75715e"># æŒ‡å®š ENTRYPOINT ä¹‹å</span>
  CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;å‚æ•°1&#34;</span>, <span style="color:#e6db74">&#34;å‚æ•°2&#34;</span>, <span style="color:#e6db74">&#34;å‚æ•°3&#34;</span>...<span style="color:#f92672">]</span>
</code></pre></div><p><code>CMD</code> æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶æ‰€è¿è¡Œçš„ç¨‹åºä¸å‚æ•°ã€‚</p>
<p>ä½¿ç”¨ <code>shell æ ¼å¼</code> æ—¶ï¼Œå®¹å™¨å®é™…ä¸Šä»¥ <code>sh -c</code> çš„å½¢å¼æ‰§è¡Œ</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">CMD echo $HOME
<span style="color:#75715e"># å®é™…æ‰§è¡Œæ—¶ä¸º</span>
CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;echo </span>$HOME<span style="color:#e6db74">&#34;</span><span style="color:#f92672">]</span>
</code></pre></div><p>æ‰€ä»¥åœ¨ Dockerfile ä¸­è®¾ç½®ç¯å¢ƒå˜é‡èƒ½å¤Ÿè¢« shell è§£æå¹¶å¤„ç†ã€‚</p>
<p>å†è€…ï¼Œç”±äºæ‰€æœ‰çš„å‘½ä»¤ç”± <code>sh</code> æ‰§è¡Œ å½“ä¸»è¿›ç¨‹çš„ <code>sh</code> é€€å‡ºåï¼Œå‘½ä»¤è‡ªç„¶ç»“æŸè¿è¡Œã€‚æ‰€ä»¥å®¹å™¨å†…éƒ¨æ²¡æœ‰åå°çš„æ¦‚å¿µã€‚</p>
<blockquote>
<p>è¿è¡Œæ—¶é•œåƒåé¢çš„å‚æ•° ä¼šæ›¿æ¢ <code>CMD</code> çš„é»˜è®¤å€¼ï¼Œå¦‚ä¸Šï¼Œå½“æˆ‘æ‰§è¡Œ <code>docker run myimage sth</code> æ—¶ <code>sth</code> ä¼šæ›¿æ¢ <code>echo $home</code>ã€‚</p>
<p><code>CMD</code> æŒ‡ä»¤åªèƒ½å‡ºç°ä¸€æ¬¡ï¼Œå‡ºç°å¤šæ¬¡åªæœ‰æœ€åä¸€ä¸ªæœ‰æ•ˆã€‚</p>
</blockquote>
<h3 id="6-entrypoint">6. ENTRYPOINT</h3>
<p><code>ENTRYPOINT</code> æ ¼å¼å’Œ <code>RUN</code> ä¸€æ ·ï¼Œä½†å…¶ç›®çš„å’Œ <code>CMD</code> ä¸€æ ·ã€‚æ—¨åœ¨æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„ç¨‹åºä¸å‚æ•°</p>
<p>å½“æŒ‡å®š <code>ENTRYPOINT</code> æ—¶ï¼Œ <code>CMD</code> å°±ä¼šè¢«å½“æˆå‚æ•°ä¼ é€’ç»™ <code>ENTRYPOINT</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;-s&#34;</span><span style="color:#f92672">]</span>
ENTRYPOINT <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;curl&#34;</span>, <span style="color:#e6db74">&#34;ip.sb&#34;</span><span style="color:#f92672">]</span>
<span style="color:#75715e"># å½“æ‰§è¡Œ docker run theimage æ—¶ ç›¸å½“äºæ‰§è¡Œ curl ip.sb -s</span>
<span style="color:#75715e"># å½“æ‰§è¡Œ docker run theimage -i æ—¶ CMD è¢«å–ä»£ ç›¸å½“äºæ‰§è¡Œ curl ip.sb -i</span>
</code></pre></div><p>è¿˜æœ‰ä¸€ä¸ªåœºæ™¯èƒ½ä½“ç°å‡º <code>ENTRYPOINT</code> ä¸ <code>CMD</code> çš„ä¸åŒä½œç”¨ã€‚å½“æŸä¸ªç¨‹åºè¦ç»è¿‡ä¸€äº›åˆå§‹åŒ–ä¹‹åæ‰èƒ½è¿è¡Œæ—¶ï¼Œå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬ ï¼Œè„šæœ¬ä¸­å…ˆè¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åå†æ¥æ”¶ <code>CMD</code> ä¸ºå‚æ•°è¿è¡Œã€‚è„šæœ¬æ”¾å…¥ <code>ENTRYPOINT</code>ä¸­æ‰§è¡Œã€‚<code>redis</code> å®˜æ–¹é•œåƒå°±æ˜¯è¿™ä¹ˆåšçš„ã€‚</p>
<blockquote>
<p><code>ENTRYPOINT</code> æŒ‡ä»¤åªèƒ½å‡ºç°ä¸€æ¬¡ï¼Œå‡ºç°å¤šæ¬¡åªæœ‰æœ€åä¸€ä¸ªæœ‰æ•ˆã€‚</p>
</blockquote>
<h3 id="7-env">7. ENV</h3>
<p>è®¾ç½®ç¯å¢ƒå˜é‡</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ENV &lt;key&gt; &lt;value&gt;
</code></pre></div></li>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ENV &lt;key&gt;<span style="color:#f92672">=</span>&lt;value&gt; &lt;key2&gt;<span style="color:#f92672">=</span>&lt;value2&gt;...
</code></pre></div></li>
</ul>
<p><code>ENV</code> å¯ä»¥å½“åš <code>Dockerfile</code> ä¸­çš„å˜é‡å­˜åœ¨ã€‚åªè¦ä¿®æ”¹å°‘éƒ¨åˆ†ï¼Œå°±å¯ä»¥åšåˆ°ä¸€ä¸ª <code>Dockerfiel</code> ç»´æŠ¤å¤šä¸ªé•œåƒå¦‚æœç”¨ã€‚</p>
<h3 id="8-arg">8. ARG</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ARG &lt;å‚æ•°å&gt; <span style="color:#f92672">[=</span>&lt;é»˜è®¤å€¼&gt;<span style="color:#f92672">]</span>
</code></pre></div><p><code>ARG</code> ä¸ <code>ENV</code> æ•ˆæœä¸€æ ·ï¼Œä½†æ˜¯ <code>ENV</code> åœ¨å®¹å™¨è¿è¡Œæ—¶ï¼Œè¿˜ä¼šå­˜åœ¨è¿™äº›å˜é‡ï¼Œè€Œ <code>ARG</code>ä»…ä»…æ˜¯ä½œä¸º <code>Dockerfile</code> æ„å»ºæ—¶çš„å‚æ•°ã€‚</p>
<blockquote>
<p>æ„å»ºæ—¶å‚æ•°é»˜è®¤å€¼å¯ä»¥è¢« <code>--build-arg &lt;å‚æ•°å&gt;=&lt;å€¼&gt;</code> è¦†ç›–ã€‚</p>
</blockquote>
<h3 id="9-volume">9. VOLUME</h3>
<p>å®šä¹‰è‡ªåŠ¨æŒ‚è½½çš„<a href="#%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86">åŒ¿åå·</a></p>
<p>æ ¼å¼</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">VOLUME <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;&lt;è·¯å¾„1&gt;&#34;</span>, <span style="color:#e6db74">&#34;&lt;è·¯å¾„2&gt;&#34;</span>...<span style="color:#f92672">]</span>
</code></pre></div></li>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">VOLUME &lt;è·¯å¾„&gt;
</code></pre></div></li>
</ul>
<blockquote>
<p>è¿è¡Œæ—¶å¯ä»¥ç”¨ <code>docker run -d -v mydata:/data xxxx</code> è¦†ç›–è¿™ä¸ªé»˜è®¤æŒ‚è½½ã€‚</p>
</blockquote>
<h3 id="10-expose">10. EXPOSE</h3>
<p>ç«¯å£å£°æ˜</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">EXPOSE &lt;ç«¯å£1&gt; <span style="color:#f92672">[</span>&lt;ç«¯å£2&gt;...<span style="color:#f92672">]</span>
</code></pre></div><p>è¿™ä»…ä»…æ˜¯ä¸€ä¸ªå£°æ˜ï¼Œå¹¶ä¸æ„å‘³ç€å®šä¹‰äº† <code>EXPOSE</code> å°±ä¸€å®šä¼šå¼€å¯è¯¥ç«¯å£ã€‚è¯¥å£°æ˜çš„ä½œç”¨æ˜¯æ–¹ä¾¿ä½¿ç”¨è€…ç†è§£è¿™ä¸ªç¨‹åºçš„å®ˆæŠ¤ç«¯å£ã€‚</p>
<blockquote>
<p>å½“è¿è¡Œ <code>docker run -P sth</code> æ—¶ï¼Œä¼šå°† <code>EXPOSE</code> å£°æ˜çš„ç«¯å£éšæœºæ˜ å°„åˆ°å®¿ä¸»æœºä¸Šã€‚</p>
</blockquote>
<h3 id="11-workdir">11. WORKDIR</h3>
<p>æŒ‡å®šå·¥ä½œç›®å½•</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">WORKDIR &lt;å·¥ä½œç›®å½•è·¯å¾„&gt; <span style="color:#75715e"># è¯¥å®¹å™¨å„å±‚çš„ç›®å½•æ”¹ä¸ºç­‰å‰ç›®å½•ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»º</span>
</code></pre></div><p><code>Dockerfile</code> ä¸­æ¯æ‰§è¡Œä¸€æ¡æŒ‡ä»¤éƒ½ä¼šå»ºç«‹ä¸€å±‚ï¼Œè€Œæ¯å±‚çš„å½“å‰ç›®å½•éƒ½æ˜¯å›ºå®šçš„ã€‚å‡å¦‚ <code>Dockerfile</code> ä¸­æœ‰ä¸¤æ¡ <code>RUN</code> ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">RUN cd /app
RUN echo <span style="color:#e6db74">&#34;Hello&#34;</span> &gt; world.txt
</code></pre></div><p>æ‰§è¡Œä¹‹åï¼Œ<code>world.txt</code> å¹¶ä¸ä¼šå‡ºç°åœ¨ <code>/app</code> ç›®å½•ä¸­ã€‚ åªä¼šåœ¨ <code>å½“å‰ç›®å½•</code> é»˜è®¤ä¸º <code>/</code> ã€‚</p>
<h3 id="13-user">13. USER</h3>
<p>æŒ‡å®šå½“å‰ç”¨æˆ·ï¼Œä¸ <code>WORKDIR</code> ç±»ä¼¼ï¼Œéƒ½ä¼šå½±å“ä»¥åçš„å±‚ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">USER &lt;ç”¨æˆ·å&gt;<span style="color:#f92672">[</span>:&lt;ç”¨æˆ·ç»„&gt;<span style="color:#f92672">]</span>
</code></pre></div><p><code>USER</code> å¹¶ä¸ä¼šè‡ªåŠ¨å»ºç«‹ä¸å­˜åœ¨çš„ç”¨æˆ·ï¼Œåˆ‡æ¢ä¹‹å‰åº”è¯¥å»ºç«‹å¥½ç›¸åº”ç”¨æˆ·ã€‚</p>
<p>å»ºè®®ä½¿ç”¨ <a href="https://github.com/tianon/gosu">gosu</a> æ¥ä»£æ›¿ <code>su</code> å’Œ <code>sudo</code> ä»¥ <code>root</code> èº«ä»½æ¥æ‰§è¡Œè¿›ç¨‹ã€‚</p>
<p>é…ç½® <code>gosu</code> ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># å»ºç«‹ redis ç”¨æˆ·ï¼Œå¹¶ä½¿ç”¨ gosu æ¢å¦ä¸€ä¸ªç”¨æˆ·æ‰§è¡Œå‘½ä»¤</span>
RUN groupadd -r redis <span style="color:#f92672">&amp;&amp;</span> useradd -r -g redis redis
<span style="color:#75715e"># ä¸‹è½½ gosu</span>
RUN wget -O /usr/local/bin/gosu <span style="color:#e6db74">&#34;https://github.com/tianon/gosu/releases/download/1.7/gosu-amd64&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   <span style="color:#f92672">&amp;&amp;</span> chmod +x /usr/local/bin/gosu <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> gosu nobody true
<span style="color:#75715e"># è®¾ç½® CMDï¼Œå¹¶ä»¥å¦å¤–çš„ç”¨æˆ·æ‰§è¡Œ</span>
CMD <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;exec&#34;</span>, <span style="color:#e6db74">&#34;gosu&#34;</span>, <span style="color:#e6db74">&#34;redis&#34;</span>, <span style="color:#e6db74">&#34;redis-server&#34;</span> <span style="color:#f92672">]</span>
</code></pre></div><h3 id="14-healthcheck">14 .HEALTHCHECK</h3>
<p>å®¹å™¨å¥åº·æ£€æŸ¥</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">HEALTHCHECK <span style="color:#f92672">[</span>é€‰é¡¹<span style="color:#f92672">]</span> CMD &lt;å‘½ä»¤&gt; <span style="color:#75715e">#æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶å†µ</span>
HEALTHCHECK NONE <span style="color:#75715e"># å±è”½åŸºç¡€å®¹å™¨çš„å¥åº·æ£€æŸ¥æŒ‡ä»¤</span>
</code></pre></div><p><code>HEALTHCHECK</code> æ”¯æŒä»¥ä¸‹é€‰é¡¹</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">--interval<span style="color:#f92672">=</span>&lt;é—´éš”&gt; <span style="color:#75715e">#ä¸¤æ¬¡å¥åº·æ£€æŸ¥çš„é—´éš”ï¼Œé»˜è®¤ 30 ç§’</span>
</code></pre></div></li>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">--timeout<span style="color:#f92672">=</span>&lt;æ—¶é•¿&gt; <span style="color:#75715e"># é»˜è®¤æ£€æŸ¥æœ‰æ•ˆçš„æ—¶é•¿ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œåˆ™æ£€æŸ¥å¤±è´¥ã€‚é»˜è®¤ 30 ç§’</span>
</code></pre></div></li>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">--retries<span style="color:#f92672">=</span>&lt;æ¬¡æ•°&gt; <span style="color:#75715e"># å½“æ£€æŸ¥å¤±è´¥ä¹‹å æ‰é‡æ–°æ£€æŸ¥çš„æ¬¡æ•° é»˜è®¤ 3 æ¬¡ã€‚å½“è¿ç»­å¤±è´¥ä¹‹åï¼Œç»“æœæ ‡è®°ä¸º unhealthy</span>
</code></pre></div></li>
</ul>
<blockquote>
<p>é€šè¿‡ <code>docker container ls</code> çš„ <code>STATUS</code> æ èƒ½çœ‹åˆ° å¥åº·çŠ¶æ€æ ‡è®°ã€‚</p>
</blockquote>
<h3 id="15-onbuild">15. ONBUILD</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ONBUILD &lt;å…¶å®ƒæŒ‡ä»¤&gt;
</code></pre></div><p>åªæœ‰å½“ä»¥å½“å‰é•œåƒä¸ºåŸºç¡€é•œåƒæ„å»ºé¡¹ç›®æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œçš„æŒ‡ä»¤ã€‚</p>
<h3 id="16-ä½¿ç”¨-dockerfile-æ„å»ºé•œåƒ">16. ä½¿ç”¨ Dockerfile æ„å»ºé•œåƒ</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build -t imageName:tag .
</code></pre></div><blockquote>
<p>åˆ‡è®°ä¸è¦å¿˜è®°åé¢çš„ç‚¹ï¼ˆdotï¼‰</p>
</blockquote>
<h2 id="dockerfile-å¤šæ®µæ„å»º">Dockerfile å¤šæ®µæ„å»º</h2>
<p><code>Docker</code> å¤šæ®µæ„å»ºå°†ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ç­‰ç¯å¢ƒä¸è¿è¡Œç¯å¢ƒåˆ†å¼€ã€‚</p>
<p>æ­¥éª¤ä¸ºå°†éœ€è¦çš„æ–‡ä»¶åœ¨ä¸€ä¸ªç¯å¢ƒæµ‹è¯•ã€ç¼–è¯‘ã€æ‰“åŒ…å¥½ä¹‹åï¼Œæ‹·è´åˆ°è¿è¡Œç¯å¢ƒã€‚</p>
<ul>
<li>
<p>golang çš„ hello-world é¡¹ç›® å¤šæ®µæ„å»ºç¤ºä¾‹</p>
<ul>
<li>app.go</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
    
    <span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
    
    <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;hello world&#34;</span>)
    }
</code></pre></div><ul>
<li>Dockerfile</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#75715e"># åˆ†æ®µ 1</span>
    FROM golang:1.12-alpine as builder
    <span style="color:#75715e"># é…ç½®å›½å†…æº ä»¥åŠå®‰è£… git</span>
    RUN sed -i <span style="color:#e6db74">&#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&#39;</span> /etc/apk/repositories <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> apk --no-cache add git
    <span style="color:#75715e"># å·¥ä½œç›®å½•</span>
    WORKDIR /go/src/github.com/go/helloworld/
    
    COPY app.go .
    <span style="color:#75715e"># ç¼–è¯‘</span>
    RUN CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> GOOS<span style="color:#f92672">=</span>linux go build -a -installsuffix cgo -o app .
    
    <span style="color:#75715e"># åˆ†æ®µ 2</span>
    FROM alpine:latest as prod
    <span style="color:#75715e"># æºå’ŒåŸºæœ¬ç¯å¢ƒ</span>
    RUN sed -i <span style="color:#e6db74">&#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&#39;</span> /etc/apk/repositories <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#f92672">&amp;&amp;</span> apk --no-cache add ca-certificates
    <span style="color:#75715e"># å·¥ä½œç›®å½•</span>
    WORKDIR /root
    <span style="color:#75715e"># ä»ä¸Šä¸€å±‚æ‹·è´æ–‡ä»¶</span>
    COPY --from<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> /go/src/github.com/go/helloworld/app .
    <span style="color:#75715e"># æ‰§è¡Œ</span>
    CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;./app&#34;</span><span style="color:#f92672">]</span>
</code></pre></div><blockquote>
<ol>
<li>
<p>å¯ä»¥åªæ„å»ºæŸä¸€æ®µçš„é•œåƒ</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build --target builder -t name/imagename:tag .
</code></pre></div></li>
<li>
<p>æ„å»ºæ—¶ï¼Œä¹Ÿèƒ½ä»å…¶ä»–é•œåƒå¤åˆ¶æ–‡ä»¶</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">COPY --from<span style="color:#f92672">=</span>nginx:latest /etc/nginx/nginx.conf /nginx.conf
</code></pre></div></li>
</ol>
</blockquote>
<h2 id="å®¹å™¨çš„æ“ä½œ">å®¹å™¨çš„æ“ä½œ</h2>
<h3 id="1å¯åŠ¨ç»ˆæ­¢é‡å¯ä¸åˆ é™¤">1.å¯åŠ¨ã€ç»ˆæ­¢ã€é‡å¯ä¸åˆ é™¤</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker container start    &lt;å®¹å™¨åç§°æˆ–id&gt;
docker container stop     &lt;å®¹å™¨åç§°æˆ–id&gt;
docker container restart  &lt;å®¹å™¨åç§°æˆ–id&gt;
docker container rm       &lt;å®¹å™¨åç§°æˆ–id&gt;
docker container prune    <span style="color:#75715e"># åˆ é™¤æ‰€æœ‰ä¸åœ¨è¿è¡Œçš„å®¹å™¨</span>
</code></pre></div><h3 id="2-ä»¥å®ˆæŠ¤çŠ¶æ€è¿è¡Œå®¹å™¨">2. ä»¥å®ˆæŠ¤çŠ¶æ€è¿è¡Œå®¹å™¨</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -d ... 
</code></pre></div><blockquote>
<p>å¯ä»¥é€šè¿‡ <code>docker container logs</code> æŸ¥çœ‹åå°ç¨‹åºè¾“å‡ºçš„å†…å®¹ã€‚</p>
</blockquote>
<h3 id="3-è¿›å…¥å®¹å™¨">3. è¿›å…¥å®¹å™¨</h3>
<ul>
<li><code>attach</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker attach &lt;å®¹å™¨åç§°æˆ–id&gt;
</code></pre></div><blockquote>
<p>å¦‚æœåœ¨è¿™é‡Œè¾“å…¥ <code>exit</code> ä¼šå¯¼è‡´å®¹å™¨åœæ­¢ã€‚</p>
</blockquote>
<ul>
<li><code>exec</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker exec -it &lt;å®¹å™¨åç§°æˆ–id&gt; bash <span style="color:#75715e"># å¯åŠ¨ bash --&gt; å®¹å™¨ä¸­æœ‰bash æ‰èƒ½å¯åŠ¨æˆåŠŸã€‚</span>
</code></pre></div><pre><code>`-i` ä½¿ `STDIN` å§‹ç»ˆå¤„äºå¯äº¤äº’çŠ¶æ€ã€‚

`-t` è™šæ‹Ÿtty

`-it` ä¸€èµ·ç”¨å°±å¯ä»¥çœ‹åˆ°ç†Ÿæ‚‰çš„ linux ç»ˆç«¯ç¯å¢ƒã€‚

&gt; è¿™é‡Œè¾“å…¥ `exit`ä¸ä¼šå¯¼è‡´å®¹å™¨åœæ­¢ï¼Œæ‰€ä»¥æ›´æ¨èç”¨ `exec`
</code></pre>
<h3 id="4-å¯¼å…¥ä¸å¯¼å‡º">4. å¯¼å…¥ä¸å¯¼å‡º</h3>
<ul>
<li>
<p>å¯¼å‡º</p>
<ul>
<li>export</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#75715e"># å¯¼å‡º id ä¸º 7691a814370e çš„å®¹å™¨å¿«ç…§ï¼Œä¿å­˜ä¸º ubuntu.tar</span>
    docker export -o ubuntu.tar 7691a814370e
    docker export 7691a814370e &gt; ubuntu.tar 
</code></pre></div><ul>
<li>save</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#75715e"># é•œåƒä¿å­˜ä¸ºæ–‡ä»¶</span>
    docker save -o ubuntu.tar test/ubunt:v1.0
</code></pre></div><ul>
<li>
<p>å¯¼å…¥</p>
<ul>
<li>import</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#75715e"># å¯¼å…¥åä¸º ubuntu.tar çš„å®¹å™¨å¿«ç…§</span>
  docker import ubuntu.tar test/ubuntu:v1.0
    cat ubuntu.tar | docker import - test/ubuntu:v1.0 
    <span style="color:#75715e"># ä»ç½‘ç»œå¯¼å…¥</span>
    docker import http://example.com/exampleimage.tgz example/imagerepo
</code></pre></div><ul>
<li>load</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#75715e"># å¯¼å…¥ ubuntu.tar ä¸ºé•œåƒ</span>
    docker load -i ubuntu.tar
    docker load &lt; ubuntu.tar
</code></pre></div><blockquote>
<p><code>export</code> ã€<code>import</code> ç›¸å½“äºè™šæ‹Ÿæœºå¿«ç…§ï¼Œåªä¿å­˜å½“å‰çŠ¶æ€ï¼Œä¸ä¿å­˜å…ƒæ•°æ®ã€‚</p>
<p><code>save</code> ã€<code>load</code> ç›¸å½“äºé•œåƒçš„å¤åˆ¶ã€‚</p>
</blockquote>
<h2 id="æ•°æ®ç®¡ç†">æ•°æ®ç®¡ç†</h2>
<h3 id="æ•°æ®å·">æ•°æ®å·</h3>
<p>æ•°æ®å·ç±»ä¼¼äº linux é‡Œé¢çš„ <code>mount</code>ã€‚æŒ‚è½½ç‚¹åŸæœ‰çš„æ–‡ä»¶å°†ä¼šè¢«éšè—ï¼Œåªæ˜¾ç¤ºæŒ‚è½½çš„æ•°æ®å·é‡Œé¢çš„æ–‡ä»¶ã€‚</p>
<ul>
<li>æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨é—´å…±äº«å’Œé‡ç”¨ã€‚</li>
<li>åˆ é™¤å®¹å™¨ä¸ä¼šå½±å“æ•°æ®å·çš„å­˜åœ¨ã€‚</li>
<li>æ›´æ–°æ•°æ®å·ä¸ä¼šå½±å“é•œåƒã€‚</li>
<li>å¯¹æ•°æ®å·ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆã€‚</li>
</ul>
<h4 id="æ•°æ®å·åˆ›å»ºæŸ¥çœ‹åˆ é™¤">æ•°æ®å·åˆ›å»ºã€æŸ¥çœ‹ã€åˆ é™¤</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker volume create my-vol
docker volume ls
docker volume rm     my-vol
docker volume prune  <span style="color:#75715e"># åˆ é™¤æ— ä¸»æ•°æ®å·</span>
</code></pre></div><h4 id="æŸ¥çœ‹æŒ‡å®šæ•°æ®å·å…·ä½“ä¿¡æ¯">æŸ¥çœ‹æŒ‡å®šæ•°æ®å·å…·ä½“ä¿¡æ¯</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker volume inspect my-vol
</code></pre></div><h4 id="å¯åŠ¨ä¸€ä¸ªæŒ‚è½½æ•°æ®å·çš„å®¹å™¨">å¯åŠ¨ä¸€ä¸ªæŒ‚è½½æ•°æ®å·çš„å®¹å™¨</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run --name web <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--mount source<span style="color:#f92672">=</span>my-vol,target<span style="color:#f92672">=</span>/webapp <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	<span style="color:#75715e"># -v my-vol:/webapp  \   # ç®€å†™</span>
	--rm -d -p  80:80 dockerdemo
<span style="color:#75715e"># æ­¤æ—¶ç›®å½• /webapp ç›¸å½“äºä¸€å—ç‹¬ç«‹çš„ç¡¬ç›˜ï¼Œå¯ä»¥åŒæ—¶åœ¨å…¶ä»–å®¹å™¨ä¸­ä½¿ç”¨ï¼Œä¹Ÿä¸ä¼šéšç€å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç»“æŸè€Œç»“æŸ</span>
</code></pre></div><h4 id="æŸ¥çœ‹å®¹å™¨ä¿¡æ¯">æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker inspect web <span style="color:#75715e"># åœ¨è¿™èƒ½çœ‹åˆ° web æŒ‚è½½çš„æ•°æ®å·çš„ä¿¡æ¯</span>
</code></pre></div><h3 id="æŒ‚è½½ä¸»æœºç›®å½•">æŒ‚è½½ä¸»æœºç›®å½•</h3>
<h4 id="æŒ‚è½½ç›®å½•">æŒ‚è½½ç›®å½•</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    docker run --name web <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	  --mount type<span style="color:#f92672">=</span>bind,source<span style="color:#f92672">=</span>/my/host/path,target<span style="color:#f92672">=</span>/webapp <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	  <span style="color:#75715e"># -v /the/host/path:/webapp \</span>
	  --rm -d -p  80:80 dockerdemo
</code></pre></div><blockquote>
<p>æ­¤æ—¶è¢«æŒ‚è½½çš„ç›®å½•å¯ä»¥è¢«å®¹å™¨è¯»å†™ï¼ˆä»¥rootèº«ä»½ï¼‰ã€‚</p>
</blockquote>
<p>æŒ‚è½½æ—¶ï¼ŒåŠ  <code>readonly</code> å‚æ•°ï¼ŒæŒ‡å®šä¸ºåªè¯»ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker run --name web <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --mount type<span style="color:#f92672">=</span>bind,source<span style="color:#f92672">=</span>/my/host/path,target<span style="color:#f92672">=</span>/webapp,readonly <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#75715e"># -v /the/host/path:/webapp:ro\</span>
  --rm -d -p  80:80 dockerdemo
</code></pre></div><h4 id="æŒ‚è½½æ–‡ä»¶">æŒ‚è½½æ–‡ä»¶</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker run --name web <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	  --mount type<span style="color:#f92672">=</span>bind,source<span style="color:#f92672">=</span>$HOME/.bash_history,target<span style="color:#f92672">=</span>/root/.bash_history <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	  <span style="color:#75715e"># -v $HOME/.bash_history:/root/.bash_history \</span>
	  --rm -d -p  80:80 dockerdemo
</code></pre></div><h2 id="ç½‘ç»œ">ç½‘ç»œ</h2>
<h3 id="ç«¯å£æ˜ å°„">ç«¯å£æ˜ å°„</h3>
<ul>
<li>éšæœºæ˜ å°„</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker run -P <span style="color:#75715e"># éšæœºæ˜ å°„ 49000~49900 ä¹‹é—´çš„ç«¯å£ã€‚</span>
</code></pre></div><ul>
<li>æŒ‡å®šç«¯å£ï¼Œæ‰€æœ‰åœ°å€</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker run -p 8080:80
</code></pre></div><ul>
<li>æŒ‡å®šåœ°å€ï¼ŒæŒ‡å®šç«¯å£</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker run -p 127.0.0.1:8080:80
</code></pre></div><ul>
<li>æŒ‡å®šåœ°å€ï¼Œéšæœºç«¯å£</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker run -p 127.0.0.1::80
</code></pre></div><ul>
<li>æŸ¥çœ‹ç«¯å£é…ç½®</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker port &lt;å®¹å™¨åç§°&gt; &lt;å®¹å™¨å†…éƒ¨ç«¯å£&gt;
</code></pre></div><blockquote>
<p><code>-p</code> æ ‡è®°æ”¯æŒå¤šç«¯å£æ˜ å°„</p>
</blockquote>
<h3 id="å®¹å™¨äº’è”">å®¹å™¨äº’è”</h3>
<h4 id="1-æ–°å»ºç½‘ç»œ">1. æ–°å»ºç½‘ç»œ</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker network create -d bridge my-net <span style="color:#75715e"># -d æŒ‡å®šç½‘ç»œç±»å‹</span>
</code></pre></div><h4 id="2-è¿æ¥ç½‘ç»œ">2. è¿æ¥ç½‘ç»œ</h4>
<ul>
<li>åˆ›å»ºç¬¬ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶è¿æ¥ç½‘ç»œã€‚</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker run -it --rm --name net1 --network my-net busybox sh
</code></pre></div><ul>
<li>åˆ›å»ºç¬¬äºŒä¸ªå®¹å™¨ï¼Œè¿æ¥åŒä¸€ç½‘ç»œã€‚</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  docker run -it --rm --name net2 --network my-net busybox sh
</code></pre></div><p>è¿™æ—¶å€™ <code>net1</code> å’Œ <code>net2</code> å¯ä»¥ç›¸äº’ ping é€šã€‚</p>
<blockquote>
<p>2020.8.1 æ›´æ–°æ·»åŠ  docker æ„å»ºå‘½ä»¤&amp;&amp;ä¼˜åŒ–Dockerfile ä¾‹å­</p>
</blockquote>

<br>
<footer>
    
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/note/2019/06/18/sql-join-illustrates/">ğŸ“ˆæ•°æ®åº“è¿æ¥çš„å›¾è¡¨å±•ç¤º</a></span>
  <span class="nav-next"></span>
</nav>





<script src="/js/math-code.js"></script>


<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
     
    color: #EE7700;
}
</style>
<script async src="/js/center-img.js"></script>

    



<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/highlight.min.js"></script>



<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/languages/yaml.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/languages/tex.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/languages/go.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/languages/powershell.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/languages/sql.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/languages/bash.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/languages/rust.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/languages/c#.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/languages/java.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/languages/c.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/languages/cpp.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



   
   <br>
   <span id="/note/2019/08/23/tutorial-of-manjaro-docker/" class="leancloud_visitors" data-flag-title="ğŸ“¦âš“ï¸Manjaro Docker ç”¨æ³•">
     
     <p></p>
   </span>
   <div id="vcomments"></div>
   <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
   <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
   <script type="text/javascript">
     new Valine({
         el: '#vcomments' ,
         appId: 'ipR0UGBwhzhpRfzhlNwHl4rR-MdYXbMMI',
         appKey: 'inbruR2BGaSxMmHIeFO4S0Rv',
         notify:  false , 
         verify:  false , 
         avatar:'monsterid', 
         placeholder: 'è¯´ç‚¹ä»€ä¹ˆå‘—~',
         visitor:  false 
     });
   </script>



  <hr>
  <div class="copyright">Â© <a href="https://blog.mygoooosh.com">DG</a> Since 2016 | <a href="https://github.com/muggleL">Github</a> | <a href="https://twitter.com/Modu_Chanyu6">Twitter</a> | Theme By <a href="https://yihui.name">Yihui Xie</a> | <a href="/index.xml">RSS</a> Feed</div>
  
  </footer>
  </article>
  
  </body>
</html>

   
